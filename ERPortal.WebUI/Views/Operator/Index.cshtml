@{
    ViewBag.Title = "Dashboard Operator";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-sm">
            <div class="card-deck">
                <div class="card d-flex rounded-pill  bg-gradient-success">
                    <div class="card-body align-items-center d-flex justify-content-center">
                        <h6 class="card-title text-center">@Html.ActionLink("Submit ER Screening Report", "SubmitERProposal", "Operator", null, new { @class = "text-white" })</h6>
                    </div>
                </div>
                <div class="card d-flex  text-white rounded-pill bg-gradient-primary">
                    <div class="card-body align-items-center d-flex justify-content-center">
                        <h6 class="card-title text-center">ER Screening Report Submission Status</h6>
                    </div>
                </div>
                <div class="card d-flex  text-white rounded-pill bg-gradient-primary">
                    <div class="card-body align-items-center d-flex justify-content-center">
                        <h6 class="card-title text-center">Submitted ER Proposals</h6>
                    </div>
                </div>
                <div class="card d-flex  text-white rounded-pill bg-gradient-primary">
                    <div class="card-body align-items-center d-flex justify-content-center">
                        <h6 class="card-title text-center">ER Proposal Submission Status</h6>
                    </div>
                </div>
                <div class="card d-flex  text-white rounded-pill bg-gradient-primary">
                    <div class="card-body align-items-center d-flex justify-content-center">
                        <h6 class="card-title text-center">View Submitted Proposals</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow-lg">
                <div class="card-header bg-gradient-info text-light">
                    <h5><i class="fas fa-table"></i> ER Screening Report Application</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-bordered nowrap" id="usertable">
                        <thead class="bg-gradient-light">
                            <tr>
                                <th>Application Id</th>
                                <th>Field Type</th>
                                <th>Field Name</th>
                                <th>Organisation</th>
                                <th>Created Date</th>
                                <th>Approval Letter</th>
                                <th>App Status</th>

                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>       
    </div>
</div>
<script>
    $(document).ready(function () {
        UserTableData();

        $('#usertable').DataTable(
            {
                scrollY: '50vh',
                scrollCollapse: true,
                paging: true,
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                //processing: true,
                // deferLoading: 5
            });         
    });
    //$(document).ajaxStart(function () {
    //    alert('ajax start');
    //});

    function UserTableData() {
        $.ajax({
            url: "@Url.Action("OperatorDashboard","Operator")",
            type: 'POST',
            async: false,
            beforeSend: function (xhr ) {
               // alert('before');
               // xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
            },            
            success: function (result) {
                console.log(result);
                var dd = "";
                var status = "";
              
                $.each(result, function (i, e) {
                    var files = "";
                    if (e.ApprovalLetter != null) {
                        $.each(e.ApprovalLetter, function (i1, e1) {

                            files += '<a class="btn btn-sm btn-primary text-truncate" style="max-width: 120px;" href="../Content/UploadedFiles/' + e1.FileName + '" target="_blank"><i class="fas fa-file-download"></i> ' + e1.FileName + '</a>';
                        });
                    }
                    status = e.Status == "AP" ? "<kbd class='bg-success'>Approved</kbd>"
                        : e.Status == "NA" ? "<kbd class='bg-warning'>New Application</kbd>"
                            : e.Status == "PWM" ? "<kbd class='bg-dark'>Pending With Me</kbd>"
                                : e.Status == "UP" ? "<kbd class='bg-info'>Under Proccessing</kbd>"
                                    : "<kbd class='bg-Warning'></kbd>";

                    dd += "<tr><td><a href='@Url.Action("SubmitERProposal","Operator")?appid=" + e.AppId + "'>" +
                        e.AppId + "</a></td><td>" + e.FieldType.Type + "</td><td>" + e.FieldName + "</td><td>" +
                        e.Organisation.Name + "</td><td>" + ToChangeDateFormate(e.CreatedAt) + "</td><td>"+files+"</td><td>"+status+"</td></tr>";

                });
                $("#usertable tbody").html(dd);
            },
            error: function () {
                alertModal("Something Went Wrong. Try Again Later");
            },
            fail: function (xhr, textStatus, errorThrown) {
                alertModal("Something Went Wrong. Try Again Later");
            }


        }).done();
    }

</script>