@model ERPortal.Core.ViewModels.AdminManageViewModel


<style>
    .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link {
        background-color: #bcf31185;
        color: darkblue;
    }
</style>

<div class="container-fluid">

    <div class="row">
        <div class="col-lg-12 shadow-lg bg-gradient-info mb-2 pt-1">
            <h3 class="text-light"><i class="fas fa-table"></i> Admin Manager</h3>
        </div>
        <!-- Tab panes -->
        <div class="tab-content shadow-lg col-lg-12 ">
            <ul class="nav nav-tabs bg-gradient-light mt-3">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#OrganisationsTab">Organisations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#FieldTypesTab">Field Types</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#UHCProductionMethodTab">UHC Production Method</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#ERScreeningInstituteTab">ER Screening Institute</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#StatusTab">Status</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#DepartmentTab">Department</a>
                </li>
            </ul>

            <div id="OrganisationsTab" class="container tab-pane active">
                <div class="card shadow-lg m-3">
                    <div class="card-body">

                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Organisation</th>
                                    <th scope="col">Type</th>
                                    <th scope="col" class="text-center">Edit/Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var Organisation in Model.Organisations)
                                {
                                    <tr id="row_@Organisation.Id">
                                        <td>@Organisation.Name</td>
                                        <td>@Organisation.Type</td>
                                        <td class="text-center">

                                            <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#formModal" data-page="Organisation" data-title="Department" data-value="@Organisation.Id"><i class="fas fa-edit"></i></button>
                                            <button type="button" class="btn btn-sm btn-danger DeleteData" data-target="Organisation" data-value="@Organisation.Id"><i class="fas fa-trash"></i></button>

                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                        <br />
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#formModal" data-page="Organisation" data-title="Organisation">Add new Organisation</button>
                    </div>
                </div>
            </div>
            <div id="FieldTypesTab" class="container tab-pane fade">
                <div class="card-body shadow-lg m-3">
                    <div class="card-body">

                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Field Type</th>
                                    <th scope="col" class="text-center">Edit/Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var FieldType in Model.FieldTypes)
                                {
                                    <tr id="row_@FieldType.Id">
                                        <td>@FieldType.Type</td>
                                        <td class="text-center">

                                            <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#formModal" data-page="FieldType" data-title="Department" data-value="@FieldType.Id"><i class="fas fa-edit"></i></button>
                                            <button type="button" class="btn btn-sm btn-danger DeleteData" data-target="FieldType" data-value="@FieldType.Id"><i class="fas fa-trash"></i></button>

                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                        <br />
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#formModal" data-page="FieldType" data-title="Field Type">Add new Field Type</button>
                    </div>
                </div>
            </div>
            <div id="UHCProductionMethodTab" class="container tab-pane fade">
                <div class="card shadow-lg m-3">
                    <div class="card-body">

                        <table class="table table-striped table-bordered ">
                            <thead>
                                <tr>
                                    <th scope="col">Method Name</th>
                                    <th scope="col">Description</th>
                                    <th scope="col" class="text-center">Edit/Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var UHCProductionMethod in Model.UHCProductionMethods)
                                {
                                    <tr id="row_@UHCProductionMethod.Id">
                                        <td>@UHCProductionMethod.Name</td>
                                        <td>@UHCProductionMethod.Description</td>
                                        <td class="text-center">


                                            <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#formModal" data-page="UHCProductionMethod" data-title="UHCProductionMethod" data-value="@UHCProductionMethod.Id"><i class="fas fa-edit"></i></button>
                                            <button type="button" class="btn btn-sm btn-danger DeleteData" data-target="UHCProductionMethod" data-value="@UHCProductionMethod.Id"><i class="fas fa-trash"></i></button>

                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <br />
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#formModal" data-page="UHCProductionMethod" data-title="UHC Production Method">Add new UHC Production Method</button>
                    </div>
                </div>
            </div>
            <div id="ERScreeningInstituteTab" class="container tab-pane fade">
                <div class="card shadow-lg m-3">
                    <div class="card-body">

                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Institute Name</th>
                                    <th scope="col">Contact Person</th>
                                    <th scope="col">Address</th>
                                    <th scope="col">Email Id</th>

                                    <th scope="col" class="text-center">Edit/Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var ERScreeningInstitute in Model.ERScreeningInstitutes)
                                {
                                    <tr id="row_@ERScreeningInstitute.Id">
                                        <td>@ERScreeningInstitute.InstituteName</td>
                                        <td>@ERScreeningInstitute.ContactPerson</td>
                                        <td>@ERScreeningInstitute.Address</td>
                                        <td>@ERScreeningInstitute.EmailID</td>
                                        <td class="text-center">
                                            <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#formModal" data-page="ERScreeningInstitute" data-title="ERScreeningInstitute" data-value="@ERScreeningInstitute.Id"><i class="fas fa-edit"></i></button>
                                            <button type="button" class="btn btn-sm btn-danger" value="@ERScreeningInstitute.Id"><i class="fas fa-trash"></i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <br />
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#formModal" data-page="ERScreeningInstitute" data-title="ERScreening Institute">Add new ERScreening Institute</button>
                    </div>
                </div>
            </div>
            <div id="StatusTab" class="container tab-pane fade">
                <div class="card shadow-lg m-3">
                    <div class="card-body">
                        @{
                            if (Model.StatusMasters.Count() != 0)
                            {
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            @*<th scope="col">Id</th>*@
                                            <th scope="col">Status Id</th>
                                            <th scope="col">Status</th>
                                            <th scope="col">Is_Active</th>
                                            <th scope="col">Created Date</th>
                                            <th scope="col">Edit/Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var statusMaster in Model.StatusMasters)
                                        {
                                            <tr id="row_@statusMaster.Id">
                                                @*<td>@statusMaster.Id</td>*@
                                                <td>@statusMaster.CustStatusId</td>
                                                <td>@statusMaster.Status</td>
                                                <td>@statusMaster.Is_Active</td>
                                                <td>@statusMaster.CreatedAt.DateTime</td>
                                                <td class="text-center">
                                                    <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#formModal" data-page="StatusMaster" data-title="StatusMaster" data-value="@statusMaster.Id"><i class="fas fa-edit"></i></button>
                                                    <button type="button" class="btn btn-sm btn-danger DeleteData" data-target="StatusMaster" data-value="@statusMaster.Id"><i class="fas fa-trash"></i></button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <h4>No Status available</h4>
                            }
                        }
                        <br />
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#formModal" data-page="StatusMaster" data-title="Status">Add New Status</button>
                    </div>
                </div>
            </div>
            <div id="DepartmentTab" class="container tab-pane fade">
                <div class="card shadow-lg m-3">
                    <div class="card-body">
                        @{
                            if (Model.Departments.Count() != 0)
                            {
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>

                                            <th scope="col">Department Name</th>
                                            <th scope="col">Sub Department Name</th>
                                            <th scope="col">Is_Active</th>
                                            <th scope="col">Created Date</th>
                                            <th scope="col">Edit/Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var department in Model.Departments)
                                        {
                                            <tr id="row_@department.Id">
                                                <td>@department.DeptName</td>
                                                <td>@department.SubDeptName</td>
                                                <td>@department.Is_Active</td>
                                                <td>@department.CreatedAt.DateTime</td>
                                                <td class="text-center">

                                                    <button type="button" class="btn btn-sm btn-warning" data-toggle="modal" data-target="#formModal" data-page="Department" data-title="Department" data-value="@department.Id"><i class="fas fa-edit"></i></button>
                                                    <button type="button" class="btn btn-sm btn-danger DeleteData" data-target="Department" data-value="@department.Id"><i class="fas fa-trash"></i></button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                            else
                            {
                                <h4>No Department available</h4>
                            }
                        }
                        <br />
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#formModal" data-page="Department" data-title="Department">Add New Department</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="formModal" tabindex="-1" role="dialog" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="formModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modalContent">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" form="myForm" class="btn btn-primary" id="saveButton">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#formModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget); // Button that triggered the modal
            var targetPage = button.data('page'); // Extract page redirection from data-* attributes
            var modalTitle = button.data('title');// Extract Modal title from data-* attributes
            var btnval = button.data('value');
            // Initiate an AJAX request here (and then updating in a callback)
            $("#formModalLabel").html("Add " + modalTitle);
            $.ajax({
                url: "/Admin/AjaxAdd?targetPage=" + targetPage,
                data: {Id:btnval},
                success: function (result) {
                    $('#modalContent').html(result);
                    if ($("#saveButton").is(":hidden")) {
                        $('#saveButton').show();
                    }
                },
                error: function () {
                    $('#modalContent').html('<div class="alert alert-danger" role="alert"> An Error has occured </div >');
                    if ($("#saveButton").is(":visible")) {
                        $('#saveButton').fadeOut();
                    }
                },
                fail: function (xhr, textStatus, errorThrown) {
                    $('#modalContent').html('<div class="alert alert-danger" role="alert">Request Failed with error: ' + errorThrown + '</div > ');
                    if ($("#saveButton").is(":visible")) {
                        $('#saveButton').fadeOut();
                    }
                }
            });
        });
        $(document).on('submit', '#myForm', function (e) {
            // stop default form submission
            e.preventDefault();
            var formUrl = $('#myForm').attr('action');
            $.ajax({
                url: formUrl,
                type: 'POST',
                data: $('#myForm').serialize(),
                success: function (result) {
                    if ('Success' == result) {
                        $('#modalContent').html('<div class="alert alert-success" role="alert"> Successfully Added </div >');
                        if ($("#saveButton").is(":visible")) {
                            $('#saveButton').fadeOut();
                        }
                    } else {
                        $('#modalContent').html(result);
                    }
                },
                error: function () {
                    $('#modalContent').html('<div class="alert alert-danger" role="alert"> An Error has occured </div >');
                    if ($("#saveButton").is(":visible")) {
                        $('#saveButton').fadeOut();
                    }
                },
                fail: function (xhr, textStatus, errorThrown) {
                    $('#modalContent').html('<div class="alert alert-danger" role="alert">Request Failed with error: ' + errorThrown + '</div > ');
                    if ($("#saveButton").is(":visible")) {
                        $('#saveButton').fadeOut();
                    }
                }
            });
        });

        $('.table').DataTable(
            {
                // scrollY: '50vh',
                scrollCollapse: true,
                paging: true,
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],

                //processing: true,
                // deferLoading: 5
            });

    });

    $(document).on('click', '.DeleteData', function () {

        var target = $(this).attr('data-target');
        var id = $(this).attr('data-value');
        $.ajax({
            url: "@Url.Action("DeleteData","Admin")",
            type: 'POST',
            data: { targetdata:target,Id : id },
            success: function (result) {
                alert(result);
            },
            error: function () {
            },
            fail: function (xhr, textStatus, errorThrown) { }



        });

    });





</script>
